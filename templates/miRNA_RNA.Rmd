---
author: "José Córdoba Caballero"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    fig_width: 12
---

<style type='text/css'>
    body .main-container { 
        max-width: 90%;
    }

    .plot_real_size {
    	overflow: scroll;
  	}

    .plot_real_size img{
    	max-width: none;
    	max-height: none;
    }

    embed {
   		width: 800px;
  		height: 800px;
  }   
</style>


# **RNAseq - miRNAseq correlation report**


```{r eigen_eigen_density, eval="EE" %in% opt$aproaches, echo=FALSE, results = 'asis'}

cat("## **RNAseq modules eigengene vs miRNAseq modules eigengene**")

cat("\nThis plot shows the distributions of correlations between RNAseq modules eigengene and miRNAseq modules eigengene.
  \n")

  pp2 <- ggplot(strategies[["EE"]]$plot_obj, aes(x = correlation)) +
       geom_density() + xlim(-1,1)
  # plot_in_div(pp2,3,3)
  pp2

```

```{r eigen_eigen_heat, eval="EE" %in% opt$aproaches, echo = FALSE, fig.height=10, fig.width=15, results = 'asis'}

cat("\n\n
  This plot shows anticorrelations between RNAseq modules eigengene and miRNAseq modules eigengene. Anticorrelation were filter using a correlarion threshold of -0.75 and a P value threshold of 0.05.
  \n")
  plot_df <- strategies[["EE"]]$plot_obj[strategies[["EE"]]$plot_obj$correlation <= -0.75,]
  plot_df <- plot_df %>% filter(pval < 0.05)
  x_elements = length(unique(plot_df$miRNAseq))
  y_elements = length(unique(plot_df$RNAseq))
  pp <- gg_heatmap(data_table = plot_df, 
                x_axis = "miRNAseq",
                y_axis = "RNAseq",
                fill = "correlation",
                text_plot= "plot_text",
                x_angle = 25,
                text_colour = "white",
                text_size = 3.5)
  
  plot_in_div(pp, 2 + (y_elements *0.2), 3 + (x_elements *0.2))

```

```{r eigen_hub_1_density, eval="Eh" %in% opt$aproaches, echo=FALSE, results = 'asis'}

cat("## **RNAseq modules eigengene vs miRNAseq modules hub gene**")

cat("\nThis plot shows the distributions of correlations between RNAseq modules eigengene and miRNAseq modules hub gene.
  \n")

  pp2 <- ggplot(strategies[["Eh"]]$plot_obj, aes(x = correlation)) +
       geom_density() + xlim(-1,1)
  # plot_in_div(pp2,3,3)
  pp2

# cat("\nThis plot shows the distributions of correlations between RNAseq modules eigengene and miRNAseq modules eigengene.")
```

```{r eigen_hub_1_heat, eval="Eh" %in% opt$aproaches, echo=FALSE, fig.height=10, fig.width=15, results = 'asis'}

cat("\n\n
  This plot shows anticorrelations between RNAseq modules eigengene and miRNAseq modules hub gene. Anticorrelation were filter using a correlarion threshold of -0.75 and a P value threshold of 0.05.
  \n")
  plot_df <- strategies[["Eh"]]$plot_obj[strategies[["Eh"]]$plot_obj$correlation <= -0.75,]
  plot_df <- plot_df[plot_df$pval <= 0.05,]
  x_elements = length(unique(plot_df$miRNAseq))
  y_elements = length(unique(plot_df$RNAseq))
  pp <- gg_heatmap(data_table = plot_df, 
                x_axis = "miRNAseq",
                y_axis = "RNAseq",
                fill = "correlation",
                text_plot= "plot_text",
                x_angle = 25,
                text_colour = "white",
                text_size = 3.5)
  
  plot_in_div(pp, 2 + (y_elements *0.2), 3 + (x_elements *0.2))

```

```{r eigen_eigen_validated, eval="Eh" %in% opt$aproaches, echo=FALSE, fig.height=10, fig.width=15, results = 'asis', warning = FALSE, message = FALSE}
    pairs_stats <- get_pairs_multiMiR(miRNAseq, RNAseq, plot_df, opt$organism)
    save(pairs_stats, file = "~/test/pairs_stats.RData")
    pp <- ggplot(pairs_stats, aes(x = validated_per, y = predicted_per)) +
    geom_point()+
    geom_text(aes(label=pair))
    pp
```
```{r eigen_eigen_validated_0, eval="Eh" %in% opt$aproaches, echo=FALSE, fig.height=10, fig.width=15, results = 'asis', warning = FALSE, message = FALSE}
    pairs_stats <- get_pairs_multiMiR(miRNAseq, RNAseq, plot_df, opt$organism, cutoff = NULL)
    pp <- ggplot(pairs_stats, aes(x = validated_per, y = predicted_per)) +
    geom_point()+
    geom_text(aes(label=pair))

    pp

```

```{r methods_comparison, echo=FALSE, results = 'asis'}

cat("## **RNAseq and miRNAseq correlation methods comparison**")


cat("\nThis plot shows the distributions of correlations between RNAseq nd miRNAseq using diferent strategies explained above.
  \n")
pp <- ggplot(strategies_dist, aes(factor(name), corr))+
  geom_violin(scale = "width", adjust = 1/15) + ylim(-1,1)
  pp

```
