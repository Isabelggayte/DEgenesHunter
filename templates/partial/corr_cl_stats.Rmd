```{r "{{cl}}_corr_stats_config", include = FALSE}
# ###########################################
# ################# READ ME #################
# ###########################################
#
# This template assumes that the following variables exists
# => clgenes :: a named list of vectors with cluster name as IDs and genes of each clusters as vectors
# => cl :: cluster ID to be used
# => norm_counts :: a data frame with columns Gene (character), Sample (character) and Count (numeric) 
# => norm_counts_gnorm :: a data frame with columns Gene (character), Sample (character) and Count (numeric) 
#
# This templates include the following chunk names:
# => <cl>_corr_stats_config
# => <cl>_explote_genes
 
# Load necessary packages
require(ggplot2)
```


```{r "{{cl}}_explore_genes", echo = FALSE}
# Load genes expressions
cl_i_genes <- clgenes[[as.character({{cl}})]]
tgt_indx <- which(norm_counts$Gene %in% cl_i_genes)
# Prepare regular cluster info
cl_profile <- cl_eigvalues_gnorm[grepl(paste(c("ME",{{cl}},"$"),collapse=""),cl_eigvalues_gnorm$Cluster_ID),]
# Plot
pp <- ggplot(mapping = aes(x = Sample)) + 
	  geom_line(data = norm_counts_gnorm[tgt_indx,], alpha = 0.05, mapping = aes(y = Count, group = Gene)) +
	  geom_line(data = cl_profile, mapping = aes(y = Count, group = Cluster_ID), color = "blue") +
	  scale_y_continuous(sec.axis = sec_axis(~.*2-1, name = "Cluster-Sample correlation")) +
      theme(axis.text.x = element_text(angle = 30, hjust = 1))
plot(pp)
```







